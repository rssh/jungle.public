<?xml version="1.0" encoding="utf-8" ?>
<project name="com.googlecode.gwt-math.patched" default="repackage" basedir="."
  xmlns:ivy="antlib:fr.jayasoft.ivy.ant"
 >

  <property file="build.properties" />

  <import file="build-ivy.xml" />


  <target name="unjar" depends="retrieve-origin" 
          description="repackage project">
    <mkdir dir="origin/gwt-math" />
    <unjar src="origin/gwt-math-${origin.version}.jar"
           dest="origin/gwt-math" />
    <mkdir dir="origin/gwt-math-server" />
    <unjar src="origin/gwt-math-server-${origin.version}.jar"
           dest="origin/gwt-math-server" />
  </target>


  <target name="patch" depends="unjar" 
              description="apply patches">
   <!--  no patches yet.
    <patch patchfile="patches/patch.1" strip="0" /> 
   -->
  </target>

  <target name="package" depends="patch" 
              description="do packaging and cleanup">
    <jar  basedir="origin/gwt-math"
           destfile="origin/gwt-math-${version}.jar" />
    <jar  basedir="origin/gwt-math-server"
           destfile="origin/gwt-math-server-${version}.jar" />
    <delete dir="origin/gwt-math" />
    <delete dir="origin/gwt-math-server" />
    <move file="origin/gwt-math-${version}.jar" todir="dist" />
    <move file="origin/gwt-math-server-${version}.jar" todir="dist" />
  </target>

  <target name="repackage" depends="package" />

  <target name="clean">
    <!-- Delete the bin directory tree -->
    <delete>
      <fileset dir="origin" includes="*.jar" />
      <fileset dir="dist" includes="*.jar,*.xml" />
    </delete>
    <delete dir="origin/gwt-math" />
    <delete dir="origin/gwt-math-server" />
  </target>

  
   <target name="publish" depends="repackage">
     <ivy:publish resolver="datacenter.gradsoft.ua" pubrevision="${version}" 
                  overwrite="true" 
                  >
       <artifacts pattern="dist/[artifact]-[revision].[ext]" />
     </ivy:publish>
    </target>

   <target name="publish.local" depends="repackage">
     <ivy:publish resolver="jungle.repo" pubrevision="${version}" 
                  overwrite="true" 
                  >
       <artifacts pattern="dist/[artifact]-[revision].[ext]" />
     </ivy:publish>
    </target>


</project>
